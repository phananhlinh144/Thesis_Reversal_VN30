name: Auto Update Data CSV

on:
  schedule:
    # Chạy lúc 15:45 chiều VN (tương ứng 8:45 AM UTC) mỗi ngày từ thứ 2 đến thứ 6
    - cron: '45 8 * * 1-5'
  workflow_dispatch: # Vẫn giữ cái này để khi nào thích thì bấm tay chạy thử

jobs:
  run_update:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Install libraries
        run: |
          pip install pandas vnstock beautifulsoup4 lxml requests

      - name: Run Update Script
        # Đổi tên file ở đây cho khớp với file python lấy data
        run: python update_data.py

      - name: Save and Push CSV
        run: |
          git config --global user.name "Data-Bot"
          git config --global user.email "bot@github.com"
          
          # Bây giờ mình lưu file raw vì AI sẽ chạy ở app.py
          if [ -f "vn30_data_raw.csv" ]; then
            git add vn30_data_raw.csv
            git commit -m "Auto-update VN30 data $(date)" || echo "No changes to commit"
            git push
          else
            echo "❌ Lỗi: Không tìm thấy file vn30_data_raw.csv!"
            exit 1
          fi
